<!doctype html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>CF Pages åŸŸåç®¡ç†æ§åˆ¶å°</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Cloudflare å“ç‰Œé…è‰²ä½“ç³» */
      --cf-orange: #F38020;
      --cf-orange-hover: #d96e16;
      --cf-dark: #1D2737;
      
      /* æµ…è‰²æ¨¡å¼ (Light) - æš–æ©™äº‘æœµé£æ ¼ */
      /* æ¸å˜ï¼šä» CF æ©™çš„ææ·¡è‰² -> çº¯ç™½ -> ææ·¡è“ */
      --bg-gradient: linear-gradient(135deg, #fff0e6 0%, #ffffff 50%, #f0f9ff 100%);
      
      --glass-sidebar: rgba(255, 255, 255, 0.65);
      --glass-content: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(243, 128, 32, 0.15); /* æ·¡æ·¡çš„æ©™è‰²è¾¹æ¡† */
      
      --text-primary: #1D2737;
      --text-secondary: #6c757d;
      
      --input-bg: rgba(255, 255, 255, 0.6);
      --input-border: rgba(0, 0, 0, 0.08);
      --input-focus: var(--cf-orange);
      
      --shadow-window: 0 24px 60px rgba(243, 128, 32, 0.1);
      --radius-window: 20px;
      --radius-element: 10px;
      
      --accent-color: var(--cf-orange);
      --danger-color: #ff3b30;
      --success-color: #34c759;
    }

    [data-theme="dark"] {
      /* æ·±è‰²æ¨¡å¼ (Dark) - æ·±é‚ƒæœºæˆ¿é£æ ¼ */
      /* æ¸å˜ï¼šæš—é»‘æ©™ -> æ·±è“ç° */
      --bg-gradient: linear-gradient(135deg, #2c1a10 0%, #1D2737 100%);
      
      --glass-sidebar: rgba(20, 20, 20, 0.7);
      --glass-content: rgba(30, 30, 30, 0.7);
      --glass-border: rgba(255, 255, 255, 0.08);
      
      --text-primary: #f5f5f7;
      --text-secondary: #9ca3af;
      
      --input-bg: rgba(255, 255, 255, 0.08);
      --input-border: transparent;
      --input-focus: #fabe87;
      
      --shadow-window: 0 40px 80px rgba(0, 0, 0, 0.6);
    }

    * { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-gradient);
      background-attachment: fixed;
      color: var(--text-primary);
      overflow: hidden;
    }

    /* çª—å£å®¹å™¨ */
    .app-window {
      width: 90%;
      max-width: 1100px;
      height: 85vh;
      max-height: 850px;
      display: flex;
      background: var(--glass-sidebar);
      backdrop-filter: blur(40px) saturate(120%);
      -webkit-backdrop-filter: blur(40px) saturate(120%);
      border-radius: var(--radius-window);
      box-shadow: var(--shadow-window);
      border: 1px solid var(--glass-border);
      position: relative;
      z-index: 10;
      flex-direction: row;
      opacity: 0;
      transform: scale(0.95);
      animation: fadeInScale 0.5s forwards;
    }

    @keyframes fadeInScale {
      to { opacity: 1; transform: scale(1); }
    }

    /* å·¦ä¾§æ  */
    .sidebar {
      width: 280px;
      border-right: 1px solid var(--glass-border);
      padding: 28px 20px;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      background: rgba(255,255,255,0.02);
    }

    /* å“ç‰Œ Logo åŒºåŸŸ */
    .brand-area {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 28px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--glass-border);
    }

    .brand-icon {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      object-fit: cover;
      box-shadow: 0 4px 12px rgba(243, 128, 32, 0.3);
    }

    .brand-text {
      font-weight: 700;
      font-size: 16px;
      color: var(--text-primary);
      letter-spacing: -0.5px;
    }

    /* è¡¨å•æ§ä»¶ */
    .control-group { margin-bottom: 18px; }

    label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select {
      width: 100%;
      padding: 12px 14px;
      font-size: 13px;
      border-radius: var(--radius-element);
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-primary);
      outline: none;
      font-family: inherit;
    }
    
    input:focus, select:focus {
      background: var(--input-bg);
      border-color: var(--input-focus);
      box-shadow: 0 0 0 3px rgba(243, 128, 32, 0.15);
    }
    
    input::placeholder { color: rgba(150,150,150,0.5); }

    /* æŒ‰é’® */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(1px); }

    .btn.primary {
      background: linear-gradient(135deg, var(--cf-orange) 0%, #e67e22 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(243, 128, 32, 0.3);
    }
    .btn.primary:hover { box-shadow: 0 6px 16px rgba(243, 128, 32, 0.4); }
    
    .btn.secondary {
      background: var(--input-bg);
      color: var(--text-primary);
      border: 1px solid var(--input-border);
    }
    .btn.secondary:hover { background: rgba(128,128,128,0.1); }

    .btn.danger {
      background: rgba(255, 59, 48, 0.1);
      color: var(--danger-color);
    }
    .btn.danger:hover { background: var(--danger-color); color: white; }

    .btn.block { width: 100%; margin-top: 8px; }

    /* åº•éƒ¨å·¥å…·æ  */
    .sidebar-footer {
      margin-top: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 15px;
      border-top: 1px solid var(--glass-border);
    }
    
    .theme-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 18px;
      padding: 6px;
      border-radius: 6px;
      color: var(--text-secondary);
    }
    .theme-btn:hover { background: rgba(128,128,128,0.1); color: var(--cf-orange); }

    /* å³ä¾§å†…å®¹åŒº */
    .content-area {
      flex: 1;
      background: var(--glass-content);
      padding: 40px 50px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .content-header h2 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
    }

    /* åŸŸååˆ—è¡¨å®¹å™¨ */
    .domain-card {
      background: var(--input-bg);
      border-radius: 16px;
      border: 1px solid var(--input-border);
      padding: 8px;
      min-height: 220px;
      margin-bottom: 30px;
      overflow-y: auto;
    }

    .domain-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 20px;
      margin-bottom: 4px;
      border-radius: 10px;
      transition: background 0.2s;
    }
    .domain-item:hover { background: rgba(128,128,128,0.05); }
    
    .status-tag {
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 20px;
      font-weight: 600;
      margin-left: 12px;
      letter-spacing: 0.5px;
    }
    .tag-active { background: rgba(52, 199, 89, 0.15); color: var(--success-color); border: 1px solid rgba(52, 199, 89, 0.2); }
    .tag-pending { background: rgba(255, 159, 10, 0.15); color: #FF9F0A; border: 1px solid rgba(255, 159, 10, 0.2); }

    /* æ“ä½œåŒºç½‘æ ¼ */
    .action-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    .action-box {
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      padding: 20px;
      border-radius: 16px;
    }

    .input-row { display: flex; gap: 10px; margin-top: 10px; }

    /* æ—¥å¿—ç»ˆç«¯ */
    .terminal {
      background: #1e1e1e;
      color: #cfd2d6;
      padding: 16px;
      border-radius: 12px;
      font-family: 'Menlo', 'Monaco', monospace;
      font-size: 12px;
      line-height: 1.6;
      height: 140px;
      overflow-y: auto;
      border: 1px solid rgba(0,0,0,0.1);
      white-space: pre-wrap;
    }
    .terminal::-webkit-scrollbar { width: 6px; }
    .terminal::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

    /* ç™»å½•é®ç½© */
    .login-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--bg-gradient);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .login-card {
      width: 340px;
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(50px);
      padding: 40px 32px;
      border-radius: 24px;
      box-shadow: 0 30px 60px rgba(243, 128, 32, 0.15);
      text-align: center;
      border: 1px solid rgba(255,255,255,0.4);
    }
    [data-theme="dark"] .login-card { background: rgba(30, 30, 30, 0.75); border-color: rgba(255,255,255,0.1); box-shadow: 0 30px 60px rgba(0,0,0,0.5); }

    /* Toast é€šçŸ¥ */
    .toast {
      position: fixed;
      top: 24px; left: 50%; transform: translateX(-50%) translateY(-100px);
      background: rgba(29, 39, 55, 0.95);
      color: white;
      padding: 12px 24px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 500;
      z-index: 200;
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    /* è¾…åŠ©ç±» */
    .hidden { display: none !important; }
    .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
      .app-window { flex-direction: column; width: 100%; height: 100%; border-radius: 0; border: none; }
      .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--glass-border); padding: 20px; }
      .content-area { padding: 20px; }
      .action-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- é€šçŸ¥æç¤º -->
  <div id="toast" class="toast">
    <span id="toastIcon">â„¹ï¸</span>
    <span id="toastMsg">é€šçŸ¥æ¶ˆæ¯</span>
  </div>

  <!-- ç™»å½•ç•Œé¢ -->
  <div id="loginScreen" class="login-overlay">
    <div class="login-card">
      <img src="https://image.hyeri.us.kg/icon.png" style="width:72px; height:72px; border-radius:18px; box-shadow:0 10px 25px rgba(243, 128, 32, 0.25); margin-bottom:24px;">
      <h3 style="margin:0 0 8px; font-size:20px;">æ¬¢è¿å›æ¥</h3>
      <p style="color:var(--text-secondary); font-size:13px; margin:0 0 28px;">Cloudflare Pages åŸŸåç®¡ç†ç»ˆç«¯</p>
      
      <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç " style="text-align:center; margin-bottom:16px;">
      <button id="loginBtn" class="btn primary block" style="height:44px; font-size:14px;">è§£ é”</button>
      <div id="errorMsg" style="color:var(--danger-color); font-size:12px; margin-top:12px; opacity:0;">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</div>
    </div>
  </div>

  <!-- ä¸»ç•Œé¢ -->
  <div id="mainScreen" class="app-window hidden">
    
    <!-- å·¦ä¾§è¾¹æ ï¼šé…ç½®ä¸å¯¼èˆª -->
    <div class="sidebar">
      <div class="brand-area">
        <img src="https://image.hyeri.us.kg/icon.png" class="brand-icon">
        <div class="brand-text">Pages æ§åˆ¶å°</div>
      </div>

      <div style="flex:1; overflow-y:auto;">
        <div class="control-group">
          <label>è´¦æˆ· ID (Account ID)</label>
          <input id="accountId" placeholder="Cloudflare Account ID" />
        </div>
        <div class="control-group">
          <label>Pages API ä»¤ç‰Œ</label>
          <input id="pagesToken" type="password" placeholder="Pages Token" />
        </div>
        <div class="control-group">
          <label>Zone API ä»¤ç‰Œ</label>
          <input id="zoneToken" type="password" placeholder="Zone Token" />
        </div>
        <div style="display:flex; gap:10px; margin-top:20px;">
          <button id="loadConfigBtn" class="btn secondary" style="flex:1;">è¯»å–</button>
          <button id="saveConfigBtn" class="btn primary" style="flex:1;">ä¿å­˜</button>
        </div>

        <hr style="border:0; border-top:1px solid var(--glass-border); margin:24px 0;">

        <div class="control-group">
          <label>é€‰æ‹©é¡¹ç›®</label>
          <select id="projectSelect"><option value="">-- è¯·å…ˆåŠ è½½é¡¹ç›® --</option></select>
          <button id="loadProjectsBtn" class="btn secondary block">è·å–é¡¹ç›®åˆ—è¡¨</button>
        </div>
      </div>

      <div class="sidebar-footer">
        <span style="font-size:12px; color:var(--text-secondary);">v2.2 CF-Theme</span>
        <button id="themeToggle" class="theme-btn" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
      </div>
    </div>

    <!-- å³ä¾§å†…å®¹åŒºï¼šä¸šåŠ¡æ“ä½œ -->
    <div class="content-area">
      <div class="content-header">
        <h2>åŸŸåç®¡ç†</h2>
        <button id="refreshDomainsBtn" class="btn secondary">åˆ·æ–°åˆ—è¡¨</button>
      </div>

      <div id="domainList" class="domain-card">
        <div style="display:flex; align-items:center; justify-content:center; height:100%; color:var(--text-secondary); flex-direction:column; gap:10px;">
          <span style="font-size:24px; opacity:0.3;">â˜ï¸</span>
          <span>ç­‰å¾…é€‰æ‹©é¡¹ç›®...</span>
        </div>
      </div>

      <div class="action-grid">
        <div class="action-box">
          <label style="color:var(--cf-orange);">æ·»åŠ åŸŸå (è‡ªåŠ¨é…ç½® DNS)</label>
          <div class="input-row">
            <input id="addDomainInput" placeholder="ä¾‹å¦‚: blog.example.com" />
            <button id="addDomainBtn" class="btn primary">æ·»åŠ </button>
          </div>
        </div>
        <div class="action-box">
          <label style="color:var(--danger-color);">ç§»é™¤åŸŸå</label>
          <div class="input-row">
            <input id="removeDomainInput" placeholder="è¾“å…¥è¦ç§»é™¤çš„åŸŸå" />
            <button id="removeDomainBtn" class="btn danger">åˆ é™¤</button>
          </div>
        </div>
      </div>

      <label>è¿è¡Œæ—¥å¿—</label>
      <div id="output" class="terminal">ç³»ç»Ÿå°±ç»ª...</div>
    </div>
  </div>

  <script>
    // --- UI äº¤äº’é€»è¾‘ ---
    const themeToggle = document.getElementById('themeToggle');
    const html = document.documentElement;
    const toast = document.getElementById('toast');
    const toastMsg = document.getElementById('toastMsg');
    const toastIcon = document.getElementById('toastIcon');
    let toastTimer;

    // ä¸»é¢˜åˆ‡æ¢
    themeToggle.addEventListener('click', () => {
      const current = html.getAttribute('data-theme');
      html.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
    });

    // Toast æç¤º
    function showToast(msg, type = 'info') {
      toastMsg.textContent = msg;
      if (type === 'success') toastIcon.textContent = 'âœ…';
      else if (type === 'error') toastIcon.textContent = 'âŒ';
      else toastIcon.textContent = 'â„¹ï¸';
      
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ç™»å½•é”™è¯¯åŠ¨ç”»
    function triggerError() {
      const err = document.getElementById('errorMsg');
      const card = document.querySelector('.login-card');
      err.style.opacity = 1;
      card.classList.remove('shake');
      void card.offsetWidth; // è§¦å‘é‡ç»˜
      card.classList.add('shake');
    }

    // --- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (API è°ƒç”¨ä¿æŒä¸å˜) ---
    const loginScreen=document.getElementById('loginScreen');
    const mainScreen=document.getElementById('mainScreen');
    const loginPassword=document.getElementById('loginPassword');
    const loginBtn=document.getElementById('loginBtn');

    async function checkLogin(){
      const password=loginPassword.value.trim();
      if(!password) return triggerError();
      try{
        const resp=await fetch('/api/auth',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({password})
        });
        const data=await resp.json();
        if(data.success){
          sessionStorage.setItem('authenticated','true');
          showMainScreen();
        }else{ triggerError(); }
      }catch(e){ triggerError(); }
    }

    function showMainScreen(){
      loginScreen.style.opacity = 0;
      setTimeout(() => {
        loginScreen.classList.add('hidden');
        mainScreen.classList.remove('hidden');
        loadConfig();
      }, 300);
    }

    loginBtn.addEventListener('click',checkLogin);
    loginPassword.addEventListener('keypress',e=>{if(e.key==='Enter')checkLogin();});

    if(sessionStorage.getItem('authenticated')==='true'){
      loginScreen.classList.add('hidden');
      mainScreen.classList.remove('hidden');
      loadConfig();
    }

    // å˜é‡å£°æ˜
    const accountId=document.getElementById('accountId');
    const pagesToken=document.getElementById('pagesToken');
    const zoneToken=document.getElementById('zoneToken');
    const projectSelect=document.getElementById('projectSelect');
    const loadProjectsBtn=document.getElementById('loadProjectsBtn');
    const domainList=document.getElementById('domainList');
    const addDomainInput=document.getElementById('addDomainInput');
    const addDomainBtn=document.getElementById('addDomainBtn');
    const removeDomainInput=document.getElementById('removeDomainInput');
    const removeDomainBtn=document.getElementById('removeDomainBtn');
    const refreshDomainsBtn=document.getElementById('refreshDomainsBtn');
    const saveConfigBtn=document.getElementById('saveConfigBtn');
    const loadConfigBtn=document.getElementById('loadConfigBtn');
    const output=document.getElementById('output');

    async function apiCall(path,method='GET',body=null){
      output.innerHTML += `<div>> è¯·æ±‚: ${method} ${path}...</div>`;
      output.scrollTop = output.scrollHeight;
      try{
        const resp=await fetch(path,{
          method,
          headers:{
            'Content-Type':'application/json',
            'X-Account-Id':accountId.value.trim(),
            'X-Pages-Token':pagesToken.value.trim(),
            'X-Zone-Token':zoneToken.value.trim()
          },
          body:body?JSON.stringify(body):null
        });
        const data=await resp.json().catch(()=>({error:'å“åº”è§£æå¤±è´¥'}));
        output.innerHTML += `<div style="color:${resp.ok?'#4cd964':'#ff3b30'}">> ç»“æœ: ${data.success?'æˆåŠŸ':'å¤±è´¥'}</div>`;
        output.scrollTop = output.scrollHeight;
        return{ok:resp.ok,data};
      }catch(e){
        output.innerHTML += `<div style="color:#ff3b30">> é”™è¯¯: ${e.message}</div>`;
        return{ok:false,data:null};
      }
    }

    async function saveConfig(){
      const config={accountId:accountId.value.trim(),pagesToken:pagesToken.value.trim(),zoneToken:zoneToken.value.trim()};
      if(!config.accountId||!config.pagesToken||!config.zoneToken) return showToast('è¯·å¡«å†™æ‰€æœ‰é…ç½®é¡¹', 'error');
      const res=await fetch('/api/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});
      const data=await res.json();
      showToast(data.success?'é…ç½®å·²ä¿å­˜':'ä¿å­˜å¤±è´¥', data.success?'success':'error');
    }

    async function loadConfig(){
      const res=await fetch('/api/config');
      const data=await res.json();
      if(data.success&&data.config){
        accountId.value=data.config.accountId||'';
        pagesToken.value=data.config.pagesToken||'';
        zoneToken.value=data.config.zoneToken||'';
        output.innerHTML += `<div>> å·²ä»äº‘ç«¯åŠ è½½é…ç½®</div>`;
      }
    }

    async function loadProjects(){
      const acc=accountId.value.trim();
      if(!acc||!pagesToken.value.trim()) return showToast('è¯·å…ˆå¡«å†™è´¦æˆ·IDå’ŒToken', 'error');
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects`);
      if(res.ok&&res.data.success){
        const projects=res.data.result||[];
        projectSelect.innerHTML=projects.map(p=>`<option value="${p.name}">${p.name}</option>`).join('');
        if(projects.length>0){
          projectSelect.value=projects[0].name;
          await loadDomains();
        }
        showToast('é¡¹ç›®åˆ—è¡¨å·²åˆ·æ–°', 'success');
      }
    }

    async function loadDomains(){
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      if(!acc||!proj)return;
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains`);
      domainList.innerHTML='';
      if(res.ok&&res.data.success){
        const domains=res.data.result||[];
        if(domains.length===0){
          domainList.innerHTML='<div style="display:flex;height:100%;align-items:center;justify-content:center;color:var(--text-secondary);">æš‚æ— ç»‘å®šåŸŸå</div>';
        }else{
          domains.forEach(d=>{
            const isAct = d.status==='active';
            const el=document.createElement('div');
            el.className='domain-item';
            el.innerHTML=`
              <div style="display:flex;align-items:center;">
                <span style="font-weight:600">${d.name}</span>
                <span class="status-tag ${isAct?'tag-active':'tag-pending'}">${isAct?'å·²æ¿€æ´»':'éªŒè¯ä¸­'}</span>
              </div>
              <button class="btn secondary" style="padding:6px 12px;font-size:12px;" onclick="confirmAndRemove('${encodeURIComponent(d.name)}')">æ–­å¼€è¿æ¥</button>
            `;
            domainList.appendChild(el);
          });
        }
      }
    }

    window.confirmAndRemove=async function(domainEncoded){
      const domain=decodeURIComponent(domainEncoded);
      if(!confirm(`ç¡®å®šè¦åˆ é™¤åŸŸå ${domain} å—?`))return;
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains/${domain}`,'DELETE');
      if(res.ok&&res.data.success){
        await loadDomains();
        showToast('åŸŸåå·²åˆ é™¤', 'success');
      } else {
        showToast('åˆ é™¤å¤±è´¥', 'error');
      }
    };

    addDomainBtn.addEventListener('click',async()=>{
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const domain=addDomainInput.value.trim();
      if(!acc||!proj||!domain) return showToast('è¯·æ£€æŸ¥è¾“å…¥', 'error');
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains`,'POST',{name:domain});
      if(res.ok&&res.data.success){
        addDomainInput.value='';
        await loadDomains();
        showToast(res.data.dns_created?'åŸŸååŠDNSè®°å½•åˆ›å»ºæˆåŠŸ':'åŸŸåæ·»åŠ æˆåŠŸ', 'success');
      } else { showToast('æ·»åŠ å¤±è´¥', 'error'); }
    });

    removeDomainBtn.addEventListener('click',async()=>{
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const domain=removeDomainInput.value.trim();
      if(!acc||!proj||!domain) return showToast('è¯·è¾“å…¥åŸŸå', 'error');
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains/${domain}`,'DELETE');
      if(res.ok&&res.data.success){
        removeDomainInput.value='';
        await loadDomains();
        showToast('åŸŸåå·²åˆ é™¤', 'success');
      } else { showToast('åˆ é™¤å¤±è´¥', 'error'); }
    });

    refreshDomainsBtn.addEventListener('click',() => { loadDomains(); showToast('åˆ—è¡¨å·²åˆ·æ–°'); });
    loadProjectsBtn.addEventListener('click',loadProjects);
    projectSelect.addEventListener('change',loadDomains);
    saveConfigBtn.addEventListener('click',saveConfig);
    loadConfigBtn.addEventListener('click',loadConfig);
  </script>
</body>
</html>
