<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CF Pages åŸŸåç®¡ç†</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --cf-orange:#F48120;
      --cf-dark:#2c3e50;
      --cf-blue:#3498db;
      --text-dark:#1a202c;
      --text-light:#4a5568;
      --glass-bg:rgba(255,255,255,0.35);
      --glass-border:rgba(255,255,255,0.5);
      --shadow:0 8px 32px rgba(44,62,80,0.15);
      --shadow-hover:0 12px 40px rgba(44,62,80,0.25);
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:'Inter',ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto;
      color:var(--text-dark);
      background:linear-gradient(135deg,#2c3e50 0%,#34495e 50%,#3d5a80 100%);
      min-height:100vh;
      position:relative;
      overflow-x:hidden;
    }
    body::before{
      content:'';
      position:fixed;
      top:0;left:0;right:0;bottom:0;
      background:url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse"><path d="M 100 0 L 0 0 0 100" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23grid)"/></svg>');
      pointer-events:none;
    }
    .container{
      max-width:1100px;
      margin:0 auto;
      padding:40px 24px;
      position:relative;
      z-index:1;
    }
    .header{
      text-align:center;
      color:#fff;
      margin-bottom:40px;
      animation:fadeInDown 0.6s ease-out;
    }
    .header h1{
      font-size:clamp(32px,5vw,48px);
      font-weight:800;
      margin:0 0 12px;
      letter-spacing:-0.02em;
      text-shadow:0 4px 20px rgba(0,0,0,0.2);
      background:linear-gradient(135deg,#fff 0%,rgba(255,255,255,0.9) 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .header p{
      margin:0;
      font-size:18px;
      font-weight:500;
      opacity:0.95;
      text-shadow:0 2px 8px rgba(0,0,0,0.15);
    }
    .card{
      background:var(--glass-bg);
      backdrop-filter:blur(20px) saturate(180%);
      -webkit-backdrop-filter:blur(20px) saturate(180%);
      border-radius:24px;
      padding:32px;
      box-shadow:var(--shadow);
      border:1px solid var(--glass-border);
      margin-bottom:24px;
      transition:all 0.3s ease;
      animation:fadeInUp 0.6s ease-out;
    }
    .card:hover{
      box-shadow:var(--shadow-hover);
      transform:translateY(-2px);
    }
    .section-title{
      font-weight:700;
      color:var(--text-dark);
      margin:0 0 20px;
      font-size:20px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    label{
      display:block;
      font-weight:600;
      color:var(--text-dark);
      margin-bottom:8px;
      font-size:15px;
    }
    input,select{
      width:100%;
      padding:16px 18px;
      font-size:15px;
      border-radius:14px;
      border:2px solid rgba(255,255,255,0.3);
      background:rgba(255,255,255,0.9);
      transition:all 0.3s ease;
      font-weight:500;
    }
    input:focus,select:focus{
      outline:none;
      border-color:rgba(255,255,255,0.8);
      background:rgba(255,255,255,1);
      box-shadow:0 0 0 4px rgba(255,255,255,0.2);
      transform:translateY(-1px);
    }
    input::placeholder{
      color:#a0aec0;
    }
    .btn{
      width:100%;
      padding:16px 24px;
      border-radius:14px;
      border:0;
      cursor:pointer;
      font-weight:700;
      font-size:16px;
      color:white;
      background:linear-gradient(135deg,rgba(255,255,255,0.95) 0%,rgba(255,255,255,0.85) 100%);
      backdrop-filter:blur(10px);
      margin-top:12px;
      transition:all 0.3s ease;
      box-shadow:0 4px 15px rgba(0,0,0,0.15);
      color:#2c3e50;
      text-shadow:none;
    }
    .btn:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 25px rgba(255,255,255,0.3);
      background:linear-gradient(135deg,rgba(255,255,255,1) 0%,rgba(255,255,255,0.95) 100%);
    }
    .btn:active{
      transform:translateY(0);
    }
    .btn.secondary{
      background:linear-gradient(135deg,#3498db 0%,#2980b9 100%);
      color:white;
    }
    .btn.secondary:hover{
      box-shadow:0 6px 25px rgba(52,152,219,0.4);
    }
    .btn.success{
      background:linear-gradient(135deg,#F48120 0%,#e67e22 100%);
      color:white;
    }
    .btn.success:hover{
      box-shadow:0 6px 25px rgba(244,129,32,0.4);
    }
    .btn.danger{
      background:linear-gradient(135deg,#e74c3c 0%,#c0392b 100%);
      color:white;
    }
    .btn.danger:hover{
      box-shadow:0 6px 25px rgba(231,76,60,0.4);
    }
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:24px;
    }
    .domain-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 18px;
      border-radius:12px;
      background:rgba(255,255,255,0.5);
      backdrop-filter:blur(10px);
      margin-bottom:10px;
      border:1px solid rgba(255,255,255,0.6);
      transition:all 0.2s ease;
    }
    .domain-item:hover{
      background:rgba(255,255,255,0.7);
      transform:translateX(4px);
    }
    .domain-name{
      font-weight:600;
      color:var(--text-dark);
      flex:1;
      font-size:15px;
    }
    .domain-status{
      font-size:13px;
      padding:4px 12px;
      border-radius:20px;
      margin:0 12px;
      font-weight:600;
    }
    .status-active{
      background:rgba(16,185,129,0.2);
      color:#065f46;
    }
    .status-pending{
      background:rgba(251,191,36,0.2);
      color:#92400e;
    }
    .domain-actions button{
      padding:8px 16px;
      font-size:13px;
      border-radius:10px;
      border:0;
      cursor:pointer;
      background:linear-gradient(135deg,#e74c3c 0%,#c0392b 100%);
      color:white;
      font-weight:600;
      transition:all 0.2s ease;
    }
    .domain-actions button:hover{
      transform:scale(1.05);
      box-shadow:0 4px 12px rgba(231,76,60,0.3);
    }
    .output{
      white-space:pre-wrap;
      background:rgba(0,0,0,0.8);
      backdrop-filter:blur(10px);
      color:#e5e7eb;
      padding:20px;
      border-radius:14px;
      min-height:120px;
      font-size:14px;
      font-family:'Courier New',monospace;
      border:1px solid rgba(255,255,255,0.1);
      line-height:1.6;
    }
    .info{
      background:rgba(255,255,255,0.85);
      backdrop-filter:blur(10px);
      border-left:4px solid #F48120;
      padding:14px 18px;
      border-radius:12px;
      font-size:14px;
      color:#2c3e50;
      margin-bottom:16px;
      font-weight:500;
    }
    .btn-group{
      display:flex;
      gap:12px;
    }
    .btn-group .btn{
      margin-top:0;
    }
    .divider{
      height:2px;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);
      margin:20px 0;
    }
    @keyframes fadeInDown{
      from{opacity:0;transform:translateY(-20px);}
      to{opacity:1;transform:translateY(0);}
    }
    @keyframes fadeInUp{
      from{opacity:0;transform:translateY(20px);}
      to{opacity:1;transform:translateY(0);}
    }
    @media(max-width:900px){
      .grid{grid-template-columns:1fr;}
      .container{padding:24px 16px;}
      .card{padding:24px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>â˜ï¸ Cloudflare Pages</h1>
      <p>åŸŸåç®¡ç† Â· è‡ªåŠ¨åˆ›å»º DNS è®°å½• + é…ç½®ä¿å­˜</p>
    </div>
    <div class="card">
      <div class="section-title">ğŸ”‘ API é…ç½®</div>
      <div class="info">ğŸ’¾ é…ç½®ä¼šä¿å­˜åœ¨ KV ä¸­,ä¸‹æ¬¡æ‰“å¼€è‡ªåŠ¨åŠ è½½</div>
      <label>Account ID<input id="accountId" placeholder="ä½ çš„ Account ID"/></label>
      <label style="margin-top:14px;">Pages API Token<input id="pagesToken" type="password" placeholder="ç”¨äºç®¡ç† Pages é¡¹ç›®"/></label>
      <label style="margin-top:14px;">Zone API Token<input id="zoneToken" type="password" placeholder="ç”¨äºåˆ›å»º DNS è®°å½•"/></label>
      <div class="btn-group" style="margin-top:16px;">
        <button class="btn success" id="saveConfigBtn" style="flex:1;">ğŸ’¾ ä¿å­˜é…ç½®</button>
        <button class="btn secondary" id="loadConfigBtn" style="flex:1;">ğŸ“¥ åŠ è½½é…ç½®</button>
      </div>
    </div>
    <div class="grid">
      <div class="card">
        <div class="section-title">ğŸ“¦ Pages é¡¹ç›®</div>
        <div style="display:flex;gap:12px;">
          <select id="projectSelect" style="flex:1;"><option value="">-- å…ˆåŠ è½½é¡¹ç›® --</option></select>
          <button class="btn secondary" id="loadProjectsBtn" style="flex:0 0 auto;width:auto;margin:0;padding:16px 24px;">åŠ è½½</button>
        </div>
        <button class="btn" id="refreshDomainsBtn">ğŸ”„ åˆ·æ–°åŸŸå</button>
      </div>
      <div class="card">
        <div class="section-title">ğŸŒ å·²ç»‘å®šåŸŸå</div>
        <div id="domainList"></div>
        <div class="divider"></div>
        <label>æ–°å¢åŸŸå<input id="addDomainInput" placeholder="sub.hyeri.us.kg"/></label>
        <button class="btn" id="addDomainBtn">â• æ·»åŠ åŸŸå + è‡ªåŠ¨åˆ›å»ºDNS</button>
        <div class="divider"></div>
        <label>åˆ é™¤åŸŸå<input id="removeDomainInput" placeholder="sub.hyeri.us.kg"/></label>
        <button class="btn danger" id="removeDomainBtn">ğŸ—‘ï¸ åˆ é™¤åŸŸå</button>
      </div>
    </div>
    <div class="card">
      <div class="section-title">ğŸ“¡ æ“ä½œæ—¥å¿—</div>
      <pre id="output" class="output">ç­‰å¾…æ“ä½œ...</pre>
    </div>
  </div>
  <script>
    const accountId=document.getElementById('accountId');
    const pagesToken=document.getElementById('pagesToken');
    const zoneToken=document.getElementById('zoneToken');
    const projectSelect=document.getElementById('projectSelect');
    const loadProjectsBtn=document.getElementById('loadProjectsBtn');
    const domainList=document.getElementById('domainList');
    const addDomainInput=document.getElementById('addDomainInput');
    const addDomainBtn=document.getElementById('addDomainBtn');
    const removeDomainInput=document.getElementById('removeDomainInput');
    const removeDomainBtn=document.getElementById('removeDomainBtn');
    const refreshDomainsBtn=document.getElementById('refreshDomainsBtn');
    const saveConfigBtn=document.getElementById('saveConfigBtn');
    const loadConfigBtn=document.getElementById('loadConfigBtn');
    const output=document.getElementById('output');

    async function apiCall(path,method='GET',body=null){
      output.textContent='â³ è¯·æ±‚ä¸­...';
      try{
        const resp=await fetch(path,{
          method,
          headers:{
            'Content-Type':'application/json',
            'X-Account-Id':accountId.value.trim(),
            'X-Pages-Token':pagesToken.value.trim(),
            'X-Zone-Token':zoneToken.value.trim()
          },
          body:body?JSON.stringify(body):null
        });
        const data=await resp.json().catch(()=>({error:'æ— æ•ˆå“åº”'}));
        output.textContent=JSON.stringify(data,null,2);
        return{ok:resp.ok,data};
      }catch(e){
        output.textContent='âŒ é”™è¯¯: '+e.message;
        return{ok:false,data:null};
      }
    }

    async function saveConfig(){
      const config={
        accountId:accountId.value.trim(),
        pagesToken:pagesToken.value.trim(),
        zoneToken:zoneToken.value.trim()
      };
      if(!config.accountId||!config.pagesToken||!config.zoneToken){
        alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
        return;
      }
      const res=await fetch('/api/config',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(config)
      });
      const data=await res.json();
      if(data.success){
        alert('âœ… é…ç½®ä¿å­˜æˆåŠŸ');
      }else{
        alert('âŒ ä¿å­˜å¤±è´¥');
      }
    }

    async function loadConfig(){
      const res=await fetch('/api/config');
      const data=await res.json();
      if(data.success&&data.config){
        accountId.value=data.config.accountId||'';
        pagesToken.value=data.config.pagesToken||'';
        zoneToken.value=data.config.zoneToken||'';
        output.textContent='âœ… é…ç½®åŠ è½½æˆåŠŸ';
      }else{
        output.textContent='âš ï¸ æœªæ‰¾åˆ°ä¿å­˜çš„é…ç½®';
      }
    }

    async function loadProjects(){
      const acc=accountId.value.trim();
      if(!acc||!pagesToken.value.trim())return alert('è¯·å¡«å†™ Account ID å’Œ Pages Token');
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects`);
      if(res.ok&&res.data.success){
        const projects=res.data.result||[];
        projectSelect.innerHTML=projects.map(p=>`<option value="${p.name}">${p.name}</option>`).join('');
        if(projects.length>0){
          projectSelect.value=projects[0].name;
          await loadDomains();
        }
      }
    }

    async function loadDomains(){
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      if(!acc||!proj)return;
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains`);
      domainList.innerHTML='';
      if(res.ok&&res.data.success){
        const domains=res.data.result||[];
        if(domains.length===0){
          domainList.innerHTML='<div style="color:#718096;padding:12px;text-align:center;font-weight:500;">æš‚æ— åŸŸå</div>';
        }else{
          domains.forEach(d=>{
            const statusClass=d.status==='active'?'status-active':'status-pending';
            const statusText=d.status==='active'?'âœ“ æ¿€æ´»':'â³ éªŒè¯ä¸­';
            const el=document.createElement('div');
            el.className='domain-item';
            el.innerHTML=`<span class="domain-name">${d.name}</span><span class="domain-status ${statusClass}">${statusText}</span><div class="domain-actions"><button onclick="confirmAndRemove('${encodeURIComponent(d.name)}')">åˆ é™¤</button></div>`;
            domainList.appendChild(el);
          });
        }
      }
    }

    window.confirmAndRemove=async function(domainEncoded){
      const domain=decodeURIComponent(domainEncoded);
      if(!confirm(`ç¡®å®šåˆ é™¤ ${domain}?`))return;
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains/${domain}`,'DELETE');
      if(res.ok&&res.data.success){
        await loadDomains();
        alert('åˆ é™¤æˆåŠŸ');
      }
    };

    addDomainBtn.addEventListener('click',async()=>{
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const domain=addDomainInput.value.trim();
      if(!acc||!proj||!domain||!pagesToken.value.trim()||!zoneToken.value.trim()){
        return alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
      }
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains`,'POST',{name:domain});
      if(res.ok&&res.data.success){
        addDomainInput.value='';
        await loadDomains();
        alert(res.data.dns_created?'âœ… åŸŸåå’ŒDNSéƒ½åˆ›å»ºæˆåŠŸ!':'âœ… åŸŸååˆ›å»ºæˆåŠŸ');
      }
    });

    removeDomainBtn.addEventListener('click',async()=>{
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const domain=removeDomainInput.value.trim();
      if(!acc||!proj||!domain)return alert('è¯·å¡«å†™å®Œæ•´');
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains/${domain}`,'DELETE');
      if(res.ok&&res.data.success){
        removeDomainInput.value='';
        await loadDomains();
        alert('åˆ é™¤æˆåŠŸ');
      }
    });

    refreshDomainsBtn.addEventListener('click',loadDomains);
    loadProjectsBtn.addEventListener('click',loadProjects);
    projectSelect.addEventListener('change',loadDomains);
    saveConfigBtn.addEventListener('click',saveConfig);
    loadConfigBtn.addEventListener('click',loadConfig);

    window.addEventListener('DOMContentLoaded',loadConfig);
  </script>
</body>
</html>
