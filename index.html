<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>CF Pages ç©ºé—´ç«™</title>
  <!-- å¼•å…¥ SF Pro é£æ ¼å­—ä½“ -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --ios-bg: #000000;
      --glass-panel: rgba(30, 30, 30, 0.65);
      --glass-panel-border: rgba(255, 255, 255, 0.12);
      --glass-input: rgba(0, 0, 0, 0.4);
      --glass-highlight: rgba(255, 255, 255, 0.08);
      --accent-primary: #0A84FF; /* iOS Blue */
      --accent-success: #30D158; /* iOS Green */
      --accent-danger: #FF453A;  /* iOS Red */
      --accent-orange: #FF9F0A;
      --text-main: #FFFFFF;
      --text-sub: rgba(255, 255, 255, 0.6);
      --radius-l: 28px;
      --radius-m: 18px;
      --radius-s: 12px;
      --shadow-dream: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      --glow-primary: 0 0 20px rgba(10, 132, 255, 0.4);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
      background-color: var(--ios-bg);
      /* æ¨¡æ‹Ÿ iOS æå…‰å£çº¸èƒŒæ™¯ */
      background-image: 
        radial-gradient(at 10% 10%, rgba(50, 80, 150, 0.4) 0px, transparent 50%),
        radial-gradient(at 90% 0%, rgba(120, 50, 150, 0.4) 0px, transparent 50%),
        radial-gradient(at 50% 90%, rgba(10, 132, 255, 0.3) 0px, transparent 50%);
      background-attachment: fixed;
      background-size: cover;
      color: var(--text-main);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }

    /* å®¹å™¨ä¸å¸ƒå±€ */
    .container {
      width: 100%;
      max-width: 1000px;
      padding: 40px 20px;
      position: relative;
      z-index: 10;
      animation: fadeEntry 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    /* å¤´éƒ¨è®¾è®¡ */
    .header {
      text-align: center;
      margin-bottom: 50px;
    }

    .header h1 {
      font-size: 42px;
      font-weight: 700;
      margin: 0 0 8px;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 2px 10px rgba(255,255,255,0.2));
    }

    .header p {
      font-size: 16px;
      color: var(--text-sub);
      font-weight: 400;
      letter-spacing: 0.5px;
    }

    /* ç»ç’ƒå¡ç‰‡ */
    .card {
      background: var(--glass-panel);
      backdrop-filter: blur(40px) saturate(150%);
      -webkit-backdrop-filter: blur(40px) saturate(150%);
      border: 1px solid var(--glass-panel-border);
      border-radius: var(--radius-l);
      padding: 32px;
      margin-bottom: 32px;
      box-shadow: var(--shadow-dream);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      box-shadow: 0 30px 60px -10px rgba(0,0,0,0.6);
      border-color: rgba(255,255,255,0.2);
    }

    /* æ ‡é¢˜ä¸åˆ†å‰²çº¿ */
    .section-title {
      font-size: 19px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
      margin: 28px 0;
    }

    /* è¡¨å•å…ƒç´  */
    label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-sub);
      margin-bottom: 10px;
      margin-left: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select {
      width: 100%;
      padding: 16px 20px;
      font-size: 16px;
      color: #fff;
      background: var(--glass-input);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: var(--radius-m);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      font-family: inherit;
      appearance: none;
    }

    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.5)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 15px center;
      padding-right: 45px;
    }

    input:focus, select:focus {
      outline: none;
      background: rgba(0,0,0,0.6);
      border-color: rgba(255,255,255,0.3);
      box-shadow: 0 0 0 4px rgba(255,255,255,0.05);
      transform: scale(1.01);
    }

    input::placeholder {
      color: rgba(255,255,255,0.25);
    }

    /* æŒ‰é’®è®¾è®¡ */
    .btn {
      width: 100%;
      padding: 16px 24px;
      border-radius: var(--radius-m);
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      margin-top: 12px;
    }

    .btn:active {
      transform: scale(0.96);
    }

    /* æŒ‰é’®å˜ä½“ */
    .btn.secondary {
      background: rgba(10, 132, 255, 0.15);
      color: var(--accent-primary);
      border-color: rgba(10, 132, 255, 0.3);
    }
    .btn.secondary:hover {
      background: var(--accent-primary);
      color: #fff;
      box-shadow: var(--glow-primary);
    }

    .btn.success {
      background: var(--text-main);
      color: #000;
    }
    .btn.success:hover {
      background: #e0e0e0;
      box-shadow: 0 0 25px rgba(255, 255, 255, 0.4);
    }

    .btn.danger {
      background: rgba(255, 69, 58, 0.15);
      color: var(--accent-danger);
      border-color: rgba(255, 69, 58, 0.3);
    }
    .btn.danger:hover {
      background: var(--accent-danger);
      color: #fff;
      box-shadow: 0 0 20px rgba(255, 69, 58, 0.4);
    }

    .btn:hover:not(.secondary):not(.danger):not(.success) {
      background: rgba(255, 255, 255, 0.2);
    }

    .btn-group {
      display: flex;
      gap: 16px;
    }
    
    /* ç½‘æ ¼å¸ƒå±€ */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
    }

    /* åŸŸååˆ—è¡¨é¡¹ */
    .domain-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.03);
      margin-bottom: 12px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: background 0.2s;
    }

    .domain-item:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .domain-name {
      font-weight: 500;
      color: #fff;
      flex: 1;
      font-size: 15px;
      letter-spacing: 0.3px;
    }

    .domain-status {
      font-size: 11px;
      padding: 6px 12px;
      border-radius: 100px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 0 16px;
    }

    .status-active {
      background: rgba(48, 209, 88, 0.2);
      color: var(--accent-success);
      box-shadow: 0 0 10px rgba(48, 209, 88, 0.1);
    }

    .status-pending {
      background: rgba(255, 159, 10, 0.2);
      color: var(--accent-orange);
    }

    .domain-actions button {
      padding: 8px 16px;
      font-size: 12px;
      border-radius: 100px;
      border: 1px solid rgba(255, 69, 58, 0.4);
      background: transparent;
      color: var(--accent-danger);
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .domain-actions button:hover {
      background: var(--accent-danger);
      color: white;
    }

    /* æ—¥å¿—è¾“å‡º */
    .output {
      background: #000;
      color: #0f0; /* Matrix Green */
      padding: 24px;
      border-radius: var(--radius-m);
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      border: 1px solid rgba(255, 255, 255, 0.1);
      min-height: 120px;
      white-space: pre-wrap;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
    }

    /* ä¿¡æ¯æç¤ºæ¡† */
    .info {
      background: rgba(10, 132, 255, 0.1);
      border: 1px solid rgba(10, 132, 255, 0.2);
      color: #bfdbfe;
      padding: 16px;
      border-radius: var(--radius-m);
      font-size: 14px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .info::before {
      content: "â„¹";
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      background: var(--accent-primary);
      color: white;
      border-radius: 50%;
      font-size: 12px;
      font-weight: bold;
    }

    /* ç™»å½•ç•Œé¢ç‰¹æœ‰ */
    .login-container {
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 100;
    }

    .login-card {
      width: 100%;
      max-width: 400px;
      padding: 48px 32px;
      background: rgba(30, 30, 30, 0.4);
      backdrop-filter: blur(50px) saturate(180%);
      border-radius: 40px;
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 40px 80px rgba(0,0,0,0.5);
      animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .login-header h2 {
      font-size: 28px;
      margin: 0 0 8px;
      color: white;
    }

    .error-msg {
      background: rgba(255, 69, 58, 0.2);
      color: #ffb3b3;
      padding: 12px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 20px;
      font-size: 14px;
      border: 1px solid rgba(255, 69, 58, 0.3);
      display: none;
    }
    .error-msg.show { display: block; animation: shake 0.4s; }

    .hidden { display: none; }

    /* å…¨å±€ Toast æ ·å¼ (çµåŠ¨å²›é£æ ¼) */
    .toast-container {
      position: fixed;
      top: 20px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      z-index: 9999;
      pointer-events: none;
    }

    .toast {
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 12px 24px 12px 16px;
      border-radius: 50px;
      color: white;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.1);
      transform: translateY(-150%) scale(0.9);
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .toast.show {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .toast-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    .toast.success .toast-icon { background: var(--accent-success); color: #000; }
    .toast.error .toast-icon { background: var(--accent-danger); color: #fff; }
    .toast.info .toast-icon { background: var(--accent-primary); color: #fff; }

    /* åŠ¨ç”»å…³é”®å¸§ */
    @keyframes fadeEntry {
      from { opacity: 0; transform: translateY(20px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    @keyframes popIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media(max-width: 800px) {
      .grid { grid-template-columns: 1fr; gap: 24px; }
      .header h1 { font-size: 32px; }
      .card { padding: 24px; border-radius: 24px; }
      .btn-group { flex-direction: column; }
    }
  </style>
</head>
<body>

  <!-- Toast é€šçŸ¥å®¹å™¨ (æ–°å¢) -->
  <div class="toast-container">
    <div id="toast" class="toast">
      <div id="toastIcon" class="toast-icon">âœ“</div>
      <div id="toastMsg">Notification</div>
    </div>
  </div>

  <!-- ç™»å½•ç•Œé¢ -->
  <div id="loginScreen" class="login-container">
    <div class="login-card">
      <div class="login-header" style="text-align: center; margin-bottom: 32px;">
        <h2>ğŸ” èº«ä»½éªŒè¯</h2>
        <p style="color:rgba(255,255,255,0.5); margin:0;">è®¿é—® Cloudflare Pages æ§åˆ¶å°</p>
      </div>
      <div id="errorMsg" class="error-msg">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</div>
      <div style="margin-bottom: 24px;">
        <input type="password" id="loginPassword" placeholder="è¾“å…¥è®¿é—®å¯†ç " style="text-align:center; font-size: 18px; letter-spacing: 2px;" />
      </div>
      <button class="btn success" id="loginBtn" style="height: 56px; font-size: 17px;">è§£é”æ§åˆ¶å°</button>
    </div>
  </div>

  <!-- ä¸»ç•Œé¢ -->
  <div id="mainScreen" class="hidden">
    <div class="container">
      <div class="header">
        <h1>Pages Commander</h1>
        <p>Cloudflare åŸŸåä¸ DNS è‡ªåŠ¨åŒ–ç®¡ç†ç»ˆç«¯</p>
      </div>

      <div class="card">
        <div class="section-title">
          <span>âš™ï¸</span> API é…ç½®ä¸­å¿ƒ
        </div>
        <div class="info">é…ç½®ä¿¡æ¯å°†åŠ å¯†å­˜å‚¨åœ¨æ‚¨çš„æœ¬åœ°æµè§ˆå™¨ä¸­</div>
        
        <div style="display: flex; flex-direction: column; gap: 16px;">
          <div>
            <label>Account ID</label>
            <input id="accountId" placeholder="Cloudflare Account ID"/>
          </div>
          <div>
            <label>Pages API Token</label>
            <input id="pagesToken" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
          </div>
          <div>
            <label>Zone API Token</label>
            <input id="zoneToken" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
          </div>
        </div>

        <div class="btn-group" style="margin-top:24px;">
          <button class="btn success" id="saveConfigBtn">ğŸ’¾ ä¿å­˜é…ç½®</button>
          <button class="btn" id="loadConfigBtn">ğŸ“¥ è¯»å–é…ç½®</button>
        </div>
      </div>

      <div class="grid">
        <!-- å·¦ä¾§ï¼šé¡¹ç›®ç®¡ç† -->
        <div class="card">
          <div class="section-title">
            <span>ğŸ“¦</span> é¡¹ç›®é€‰æ‹©
          </div>
          <div style="display:flex; gap:12px; margin-bottom: 16px;">
            <select id="projectSelect" style="flex:1; cursor: pointer;">
              <option value="">-- ç­‰å¾…åŠ è½½é¡¹ç›® --</option>
            </select>
            <button class="btn secondary" id="loadProjectsBtn" style="flex:0 0 auto; width:auto; margin:0; padding: 0 20px;">
              åŠ è½½
            </button>
          </div>
          <button class="btn" id="refreshDomainsBtn" style="background: rgba(255,255,255,0.05);">
            ğŸ”„ åˆ·æ–°åŸŸååˆ—è¡¨
          </button>
        </div>

        <!-- å³ä¾§ï¼šåŸŸåç®¡ç† -->
        <div class="card">
          <div class="section-title">
            <span>ğŸŒ</span> åŸŸåç»‘å®š
          </div>
          
          <div id="domainList" style="margin-bottom: 24px; max-height: 200px; overflow-y: auto; padding-right: 4px;">
            <!-- JSåŠ¨æ€æ’å…¥ -->
            <div style="text-align: center; color: rgba(255,255,255,0.3); padding: 20px; border: 2px dashed rgba(255,255,255,0.1); border-radius: 12px;">
              æš‚æ— æ•°æ®
            </div>
          </div>

          <div class="divider"></div>

          <div style="margin-bottom: 20px;">
            <label>æ·»åŠ æ–°åŸŸå (Auto DNS)</label>
            <div style="display: flex; gap: 10px;">
              <input id="addDomainInput" placeholder="sub.example.com" style="flex:1;"/>
              <button class="btn success" id="addDomainBtn" style="width: auto; margin:0; white-space: nowrap;">
                â• æ·»åŠ 
              </button>
            </div>
          </div>

          <div>
            <label style="color: #ff6b6b;">ç§»é™¤åŸŸå</label>
            <div style="display: flex; gap: 10px;">
              <input id="removeDomainInput" placeholder="sub.example.com" style="flex:1;"/>
              <button class="btn danger" id="removeDomainBtn" style="width: auto; margin:0; white-space: nowrap;">
                ğŸ—‘ï¸ åˆ é™¤
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨ï¼šæ—¥å¿— -->
      <div class="card" style="margin-bottom: 60px;">
        <div class="section-title">
          <span>ğŸ“¡</span> é€šä¿¡æ—¥å¿—
        </div>
        <pre id="output" class="output">System Ready...</pre>
      </div>
    </div>
  </div>

  <script>
    // Toast é€šçŸ¥å‡½æ•°
    const toastEl = document.getElementById('toast');
    const toastIcon = document.getElementById('toastIcon');
    const toastMsg = document.getElementById('toastMsg');
    let toastTimeout;

    function showToast(message, type = 'success') {
      // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
      if (toastTimeout) clearTimeout(toastTimeout);

      // è®¾ç½®å†…å®¹å’Œæ ·å¼
      toastMsg.textContent = message;
      toastEl.className = `toast show ${type}`; // é‡ç½®ç±»åå¹¶æ·»åŠ ç±»å‹
      
      // è®¾ç½®å›¾æ ‡
      if (type === 'success') toastIcon.innerHTML = 'âœ“';
      else if (type === 'error') toastIcon.innerHTML = 'âœ•';
      else toastIcon.innerHTML = 'â„¹';

      // 3ç§’åéšè—
      toastTimeout = setTimeout(() => {
        toastEl.classList.remove('show');
      }, 3000);
    }

    // ç™»å½•é€»è¾‘
    const loginScreen=document.getElementById('loginScreen');
    const mainScreen=document.getElementById('mainScreen');
    const loginPassword=document.getElementById('loginPassword');
    const loginBtn=document.getElementById('loginBtn');
    const errorMsg=document.getElementById('errorMsg');

    async function checkLogin(){
      const password=loginPassword.value.trim();
      if(!password){
        showError();
        return;
      }

      try{
        const resp=await fetch('/api/auth',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({password})
        });
        const data=await resp.json();
        
        if(data.success){
          sessionStorage.setItem('authenticated','true');
          showMainScreen();
        }else{
          showError();
        }
      }catch(e){
        showError();
      }
    }

    function showError(){
      errorMsg.classList.add('show');
      loginPassword.value='';
      loginPassword.focus();
      setTimeout(()=>errorMsg.classList.remove('show'),3000);
    }

    function showMainScreen(){
      loginScreen.classList.add('hidden');
      mainScreen.classList.remove('hidden');
      loadConfig();
    }

    loginBtn.addEventListener('click',checkLogin);
    loginPassword.addEventListener('keypress',e=>{
      if(e.key==='Enter')checkLogin();
    });

    // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
    if(sessionStorage.getItem('authenticated')==='true'){
      showMainScreen();
    }

    // åŸæœ‰çš„ä¸»ç•Œé¢é€»è¾‘
    const accountId=document.getElementById('accountId');
    const pagesToken=document.getElementById('pagesToken');
    const zoneToken=document.getElementById('zoneToken');
    const projectSelect=document.getElementById('projectSelect');
    const loadProjectsBtn=document.getElementById('loadProjectsBtn');
    const domainList=document.getElementById('domainList');
    const addDomainInput=document.getElementById('addDomainInput');
    const addDomainBtn=document.getElementById('addDomainBtn');
    const removeDomainInput=document.getElementById('removeDomainInput');
    const removeDomainBtn=document.getElementById('removeDomainBtn');
    const refreshDomainsBtn=document.getElementById('refreshDomainsBtn');
    const saveConfigBtn=document.getElementById('saveConfigBtn');
    const loadConfigBtn=document.getElementById('loadConfigBtn');
    const output=document.getElementById('output');

    async function apiCall(path,method='GET',body=null){
      output.textContent='â³ è¯·æ±‚ä¸­...';
      try{
        const resp=await fetch(path,{
          method,
          headers:{
            'Content-Type':'application/json',
            'X-Account-Id':accountId.value.trim(),
            'X-Pages-Token':pagesToken.value.trim(),
            'X-Zone-Token':zoneToken.value.trim()
          },
          body:body?JSON.stringify(body):null
        });
        const data=await resp.json().catch(()=>({error:'æ— æ•ˆå“åº”'}));
        output.textContent=JSON.stringify(data,null,2);
        return{ok:resp.ok,data};
      }catch(e){
        output.textContent='âŒ é”™è¯¯: '+e.message;
        return{ok:false,data:null};
      }
    }

    async function saveConfig(){
      const config={
        accountId:accountId.value.trim(),
        pagesToken:pagesToken.value.trim(),
        zoneToken:zoneToken.value.trim()
      };
      if(!config.accountId||!config.pagesToken||!config.zoneToken){
        showToast('è¯·å¡«å†™æ‰€æœ‰é…ç½®å­—æ®µ', 'error');
        return;
      }
      const res=await fetch('/api/config',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(config)
      });
      const data=await res.json();
      if(data.success){
        showToast('é…ç½®å·²ä¿å­˜', 'success');
      }else{
        showToast('ä¿å­˜å¤±è´¥', 'error');
      }
    }

    async function loadConfig(){
      const res=await fetch('/api/config');
      const data=await res.json();
      if(data.success&&data.config){
        accountId.value=data.config.accountId||'';
        pagesToken.value=data.config.pagesToken||'';
        zoneToken.value=data.config.zoneToken||'';
        output.textContent='âœ… é…ç½®åŠ è½½æˆåŠŸ';
      }else{
        output.textContent='âš ï¸ æœªæ‰¾åˆ°ä¿å­˜çš„é…ç½®';
      }
    }

    async function loadProjects(){
      const acc=accountId.value.trim();
      if(!acc||!pagesToken.value.trim()){
        showToast('ç¼ºå°‘ Account ID æˆ– Token', 'error');
        return;
      }
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects`);
      if(res.ok&&res.data.success){
        const projects=res.data.result||[];
        projectSelect.innerHTML=projects.map(p=>`<option value="${p.name}">${p.name}</option>`).join('');
        if(projects.length>0){
          projectSelect.value=projects[0].name;
          await loadDomains();
        }
      }
    }

    async function loadDomains(){
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      if(!acc||!proj)return;
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains`);
      domainList.innerHTML='';
      if(res.ok&&res.data.success){
        const domains=res.data.result||[];
        if(domains.length===0){
          domainList.innerHTML='<div style="color:rgba(255,255,255,0.4);padding:20px;text-align:center;border:1px dashed rgba(255,255,255,0.1);border-radius:12px;">æš‚æ— åŸŸå</div>';
        }else{
          domains.forEach(d=>{
            const statusClass=d.status==='active'?'status-active':'status-pending';
            const statusText=d.status==='active'?'Active':'Verifying';
            const el=document.createElement('div');
            el.className='domain-item';
            el.innerHTML=`<span class="domain-name">${d.name}</span><span class="domain-status ${statusClass}">${statusText}</span><div class="domain-actions"><button onclick="confirmAndRemove('${encodeURIComponent(d.name)}')">æ–­å¼€</button></div>`;
            domainList.appendChild(el);
          });
        }
      }
    }

    window.confirmAndRemove=async function(domainEncoded){
      const domain=decodeURIComponent(domainEncoded);
      if(!confirm(`ç¡®å®šåˆ é™¤ ${domain}?`))return;
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains/${domain}`,'DELETE');
      if(res.ok&&res.data.success){
        await loadDomains();
        showToast('åˆ é™¤æˆåŠŸ', 'success');
      } else {
        showToast('åˆ é™¤å¤±è´¥', 'error');
      }
    };

    addDomainBtn.addEventListener('click',async()=>{
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const domain=addDomainInput.value.trim();
      if(!acc||!proj||!domain||!pagesToken.value.trim()||!zoneToken.value.trim()){
        showToast('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
        return;
      }
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains`,'POST',{name:domain});
      if(res.ok&&res.data.success){
        addDomainInput.value='';
        await loadDomains();
        const msg = res.data.dns_created ? 'åŸŸåå’Œ DNS å·²åˆ›å»º!' : 'åŸŸåå·²æ·»åŠ ';
        showToast(msg, 'success');
      } else {
        showToast('æ·»åŠ å¤±è´¥', 'error');
      }
    });

    removeDomainBtn.addEventListener('click',async()=>{
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const domain=removeDomainInput.value.trim();
      if(!acc||!proj||!domain) {
        showToast('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯', 'error');
        return;
      }
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains/${domain}`,'DELETE');
      if(res.ok&&res.data.success){
        removeDomainInput.value='';
        await loadDomains();
        showToast('åˆ é™¤æˆåŠŸ', 'success');
      } else {
        showToast('åˆ é™¤å¤±è´¥', 'error');
      }
    });

    refreshDomainsBtn.addEventListener('click',loadDomains);
    loadProjectsBtn.addEventListener('click',loadProjects);
    projectSelect.addEventListener('change',loadDomains);
    saveConfigBtn.addEventListener('click',saveConfig);
    loadConfigBtn.addEventListener('click',loadConfig);
  </script>
</body>
</html>
